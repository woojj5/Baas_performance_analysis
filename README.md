# 🔋 EV 배터리 및 전비 노화 정밀 진단 시스템 (BASS) 기술 명세서

본 문서는 전기차(EV) 시계열 데이터를 활용하여 배터리 성능 저하를 진단하는 분석 엔진의 논리적 근거와 세부 설계 기준을 상세히 설명합니다.

---

## 1. 전비 보정의 필요성 (Why We Normalize?)
전기차의 '전비(kWh/km)'는 물리적으로 매우 불안정한 지표입니다. 보정 없이 전비 수치만으로 노화를 판단하면 다음과 같은 오류가 발생합니다.

*   **온도 및 계절 영향 (Temperature & Seasonality)**: 영하의 날씨에서는 배터리 내부 저항 증가와 히터 가동으로 전비가 최대 40%까지 급락합니다. 이를 보정하지 않으면 **"겨울에 운행한 모든 차는 노화되었다"**는 잘못된 결론에 도달합니다.
*   **주행 속도 영향 (Aerodynamic Drag)**: 공기 저항은 속도의 제곱에 비례합니다. 고속도로 위주 주행 차량이 시내 주행 차량보다 전비가 낮은 것은 물리적 당연함이지 성능 저하가 아닙니다.
*   **차급 및 용량 차이 (Capacity & Segment)**: 대형 SUV와 경차의 전비를 직접 비교하는 것은 공정하지 않습니다. 각 차급이 가진 물리적 한계를 인지해야 합니다.

**[해결책]**: Huber Regression 모델을 통해 온도(`avg_temp`), 온도 제곱(`temp_sq`), 주행 속도(`avg_speed`)를 독립 변수로 입력하여, **"모든 차량이 20도 기온에서 60km/h로 정속 주행했다면?"**을 가정한 보정 전비(`norm_kwh`)를 산출합니다.

---

## 2. 계층적 베이스라인 결정 로직 (Case 1~4)
"어떤 상태가 100점인가?"를 결정하는 기준은 데이터의 양에 따라 4단계로 자동 전환됩니다. 이는 데이터가 부족한 차종이 억울하게 평가받는 것을 방지하기 위함입니다.

| 구분 | 명칭 | 선정 기준 (Criteria) | 선정 이유 및 목적 |
|:---:|:---|:---|:---|
| **Case 1** | **차종 전용** | 동일 차종 신차(<1만km) 데이터가 500세션 이상일 때 | 가장 정확한 기준. 동일 하드웨어를 가진 신차의 성적을 100점으로 설정하여 오차를 최소화함. |
| **Case 2** | **세그먼트 가중** | 동일 차종 데이터가 부족하나 유사 세그먼트 데이터는 풍부할 때 | 데이터 부족에 의한 통계적 왜곡 방지. 해당 차종 성적과 유사 그룹(예: 중형 SUV) 성적을 가중치 있게 섞어 안정적 기준 수립. |
| **Case 3** | **ReVIN 매핑** | 신차 데이터가 거의 없는 특수/신규 차종일 때 | **Instance Normalization** 기법 적용. 차량의 현재 분포 특성을 세그먼트 전체의 통계적 분포로 강제 매핑하여 베이스라인을 역추적함. |
| **Case 4** | **글로벌 평균** | 위 모든 기준에 부합하지 않는 완전한 신규 케이스 | 진단 불가를 방지하기 위한 최소한의 장치. 전체 차량의 중앙값을 임시 기준으로 활용. |

---

## 3. 트러블슈팅 및 모델 진화 과정 (Troubleshooting & Evolution)

분석 과정에서 발견된 치명적인 오류들과 이를 극복하기 위한 고도화 단계입니다.

### Issue 1: 선형 외삽의 함정과 가짜 노화율 (-400% 사건)
*   **문제**: 관측 기간이 짧은(30일 미만) 차량의 단기 전비 하락을 1년(365일)으로 단순 곱셈하여, 연간 노화율이 -400%처럼 말 안 되는 수치로 튀는 현상 발생.
*   **해결**: 
    1. **시간적 장벽**: 최소 200일 이상 관측된 차량만 노화율 산출.
    2. **비선형 수축 가중치**: 데이터 기간이 짧을수록 신뢰도를 제곱비례로 깎아 노화율을 0%로 강제 수축.
    3. **물리적 클램핑**: 연간 노화율 상하한을 [-8%, +4%]로 제한.
*   **결과**: ![Refined Aging](final_refined_aging_report.jpg) (현실적인 노화 분포 확보)

### Issue 2: 상용차의 억울한 저득점 (과적 vs 노화)
*   **문제**: 포터2, 봉고3 등 상용차가 배터리는 건강함에도 무거운 짐을 실어 전비가 낮게 측정되어 '노화 고위험군'으로 오진됨.
*   **해결**: **Payload Stress Index** 도입. 동일 속도 구간의 타 차량 대비 에너지 초과 소모량을 계산하여 '적재 스트레스'를 수치화하고 이를 PI에서 보정함.
*   **결과**: ![Stress Correction](pi_calibration_comparison.jpg) (상용차 PI가 100% 근처로 대폭 복원됨)

### Issue 3: 단기 주행 패턴에 의한 추세 왜곡
*   **문제**: 하루 이틀 험하게 운전한 데이터가 전체 노화 회귀선의 기울기를 망가뜨림.
*   **해결**: **30일 이동 평균(Moving Average)** 필터 적용. 개별 세션의 노이즈를 걷어내고 묵직한 배터리 건강 상태의 흐름만 추출.
*   **결과**: ![Trend Analysis](trend_based_aging_analysis.jpg) (부드럽고 논리적인 노화 궤적 도출)

---

## 4. 왜 "처음값"을 기준으로 분석하는가? (Self-Referenced Baseline)
기존의 타 차량 대비 비교(Fleet-based) 방식은 **"내 차가 원래 효율이 안 좋은 모델인 건지, 아니면 타다가 나빠진 건지"**를 구분할 수 없습니다.

*   **개별 특성 수용**: 어떤 차량은 처음부터 연비 주행을 잘했고, 어떤 차량은 처음부터 적재량이 많았을 수 있습니다.
*   **노화의 정의**: 노화는 **"과거의 나 대비 현재의 내가 얼마나 변했는가"**의 문제입니다.
*   **분석 방법**: 각 차량의 데이터 시작 시점(초기 15세션)을 **'건강했던 시절(100%)'**로 정의합니다. 이후 발생하는 모든 전비 하락은 외부 요인이 아닌 **순수한 성능 감퇴**로 간주합니다.

---

## 5. 최종 시각화 산출물 요약 (Key Visuals)

### 📊 [진단 결과] 차종별 노화 분포 및 개별 차량 진단
차종별로 성능 유지율과 연간 노화율의 상관관계를 분석하여, 어떤 차종의 어떤 차량이 관리가 필요한지 한눈에 파악합니다.
![Individual Diagnostic](car_type_aging_trend_diagnostic.jpg)

### ⚖️ [보정 효과] 적재 및 주행 스트레스 보정 (Calibration)
단순 전비가 아닌, 실제 부하(Payload)를 고려했을 때 성능 지수가 어떻게 정상 범위로 복원되는지 입증합니다.
![Calibration Comparison](pi_calibration_comparison.jpg)

### 📈 [노화 추세] 고위험군 vs 우수 차량 추세 분석
시간의 흐름에 따른 성능 유지율(Retention)의 변화를 추적하여, 실제 노화가 진행 중인 차량을 선별합니다.
![Trend Analysis](trend_based_aging_analysis.jpg)

### 🚛 [스트레스 분석] 적재량과 전비의 상관관계
상용차 등에서 적재량(Payload)이 전비 하락에 미치는 물리적 영향을 분석한 근거 데이터입니다.
![Stress Analysis](stress_impact_analysis.jpg)

### 🏁 [최종 보고] 정제된 노화율 통계
데이터 노이즈와 기간 왜곡을 제거한 후 산출된 최종적인 신뢰 가능 노화율 분포입니다.
![Final Report](final_refined_aging_report.jpg)

---
**최종 업데이트**: 2025-12-24
**분석 엔진**: BASS v2.8 (Ultra-Conservative Self-Referenced Engine)
